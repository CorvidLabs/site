<div appDraggable appResizable #elementWithDrag [style.width.px]="width()" [style.height.px]="height()" [minimalWidth]="400" [minimalHeight]="850" (windowResize)="onResize($event)" class="float-window">

  <!-- Header acts as the drag handle -->
  <div class="drag-handle" [class.cursor-grab]="!isDragging" [class.cursor-grabbing]="isDragging" (mousedown)="isDragging = true" (mouseup)="isDragging = false">
    <h2>{{ title() }}</h2>
    <button (click)="close()" class="drag-handle-close">
      &times;
    </button>
  </div>

  <!-- Tetris Content -->
  <div class="tetris-content">
    <div class="game-info">
      <div class="info-item">
        <span class="info-label">Score:</span>
        <span class="info-value">{{ score() }}</span>
      </div>
      <div class="info-item">
        <span class="info-label">Level:</span>
        <span class="info-value">{{ level() }}</span>
      </div>
      <div class="info-item">
        <span class="info-label">Lines:</span>
        <span class="info-value">{{ lines() }}</span>
      </div>
    </div>

    <div class="game-board-container">
      <div class="game-board">
        @for (row of getRows(); track row) {
          <div class="board-row">
            @for (col of getCols(); track col) {
              <div
                class="board-cell"
                [style.background-color]="getCellColor(row, col) || 'transparent'"
                [class.empty]="!getCellColor(row, col)">
              </div>
            }
          </div>
        }
      </div>

      @if (isGameOver()) {
        <div class="game-overlay">
          <div class="game-over-message">
            <h2>Game Over!</h2>
            <p>Final Score: {{ score() }}</p>
            <button class="nes-btn is-primary" (click)="restartGame()">
              <cvd-pixel-icon [name]="'refresh'"></cvd-pixel-icon>
              Play Again
            </button>
          </div>
        </div>
      }

      @if (isPaused() && !isGameOver()) {
        <div class="game-overlay">
          <div class="paused-message">
            <h2>Paused</h2>
            <p>Press P to resume</p>
          </div>
        </div>
      }
    </div>

    <div class="game-controls">
      <button class="nes-btn" (click)="togglePause()" [disabled]="isGameOver()">
        <cvd-pixel-icon [name]=" isPaused() ? 'play' : 'pause' "></cvd-pixel-icon>
        {{  isPaused() ? 'Resume' : 'Pause' }}
      </button>

      <button class="nes-btn" (click)="restartGame()">
        <cvd-pixel-icon [name]="'refresh'"></cvd-pixel-icon>
        Restart
      </button>
    </div>

    <div class="game-instructions">
      <div #controlsItem class="faq-item" (click)="toggleControls(); togglePause()">
        <div class="faq-question">
          <strong>Controls</strong>
          <span class="faq-arrow">&darr;</span>
        </div>
        <div class="faq-answer">
          <p>← → Move</p>
          <p>↑ / Space — Rotate</p>
          <p>↓ — Drop</p>
          <p>P — Pause</p>
        </div>
      </div>
    </div>
  </div>
</div>
