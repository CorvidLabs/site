<div appDraggable appResizable (windowResize)="onResize($event)" #elementWithDrag [style.width.px]="width()" [style.height.px]="height()" class="float-window">

  <!-- Header acts as the drag handle -->
  <div class="drag-handle" [class.cursor-grab]="!isDragging" [class.cursor-grabbing]="isDragging" (mousedown)="isDragging = true" (mouseup)="isDragging = false">
    <h2>{{ title() }}</h2>
    <!-- Close button -->
    <button (click)="close()" class="drag-handle-close">
      &times;
    </button>
  </div>

  <!-- Window Content -->
  <div class="float-window-content">

    <section id="user-account" class="nes-container with-title">
      <label class="title">User Account</label>

      <div class="user-account-content">
        <!-- Clickable Avatar -->
        <div class="user-avatar-wrapper" (click)="onChangeProfilePicture()">
          @if(isAuthenticated() && userImage()) {
            <img [src]="userImage()" alt="User Profile" class="user-avatar-image" />
          } @else {
            <cvd-pixel-icon name="user" size="lg" class="user-avatar-icon"></cvd-pixel-icon>
          }
          
          <div class="avatar-overlay">
            <cvd-pixel-icon name="edit" size="sm"></cvd-pixel-icon>
          </div>
        </div>

        <!-- User Status & Info -->
        <div class="user-info">
          @if(isAuthenticated()) {
            <p class="user-status authenticated">
              <cvd-pixel-icon name="check" size="sm"></cvd-pixel-icon>
              <span>Logged In</span>
            </p>

            @if(userAccountAddress()) {
              <p class="user-wallet">{{ userAccountAddress()!.substring(0, 8) }}...{{ userAccountAddress()!.substring(userAccountAddress()!.length - 6) }}</p>
            }

            <button class="nes-btn is-error logout-btn" (click)="onLogout()">
              <cvd-pixel-icon name="logout" size="sm"></cvd-pixel-icon>
              <span>Sign Out</span>
            </button>

          } @else {
            <p class="user-status not-authenticated">
              <cvd-pixel-icon name="contact-delete" size="sm"></cvd-pixel-icon>
              <span>Not Logged In</span>
            </p>
            
            <button class="nes-btn is-primary login-btn" (click)="onChangeUser()">
              <cvd-pixel-icon name="login" size="sm"></cvd-pixel-icon>
              <span>Sign In</span>
            </button>
          }
        </div>
      </div>
    </section>

    <section id="theme" class="nes-container with-title">
      <label class="title !text-lg">Theme</label>
      <app-theme-switcher></app-theme-switcher>
    </section>

    <section id="sound-effects" class="nes-container with-title">
      <label class="title">Sound Effects</label>

      <div class="sound-settings-content">
        <div class="setting-row">
          <label class="setting-label">
            <cvd-pixel-icon name="volume" size="sm"></cvd-pixel-icon>
            <span>Click Sounds</span>
          </label>

          <label class="nes-checkbox">
            <input
              type="checkbox"
              [checked]="soundEffectService.clickSoundEnabled()"
              (change)="soundEffectService.toggleClickSound()"
            />
            <span></span>
          </label>
        </div>

        <p class="setting-description">
          Play sound effects when clicking anywhere on the page
        </p>
      </div>
    </section>
  </div>
</div>
