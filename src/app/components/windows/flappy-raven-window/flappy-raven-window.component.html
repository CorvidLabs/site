<div appDraggable [style.width.px]="width()" [style.height.px]="height()" [appDraggableInitialPosition]="initialPosition" class="float-window">

  <!-- Header acts as the drag handle -->
  <div class="drag-handle" [class.cursor-grab]="!isDragging" [class.cursor-grabbing]="isDragging" (mousedown)="isDragging = true" (mouseup)="isDragging = false">
    <label>{{ title }}</label>
    <button (click)="close()" class="drag-handle-close">
      &times;
    </button>
  </div>

  <!-- Game Content -->
  <div class="game-content">
    <!-- Game Stats -->
    <div class="game-stats">
      <div class="stat">
        <app-pixel-icon name="stars" />
        <span>{{ score() }}</span>
      </div>
      @if (bestScore() > 0) {
        <div class="stat best">
          <app-pixel-icon name="emoji_events" />
          <span>{{ bestScore() }}</span>
        </div>
      }
    </div>

    <!-- Game Canvas Container -->
    <div class="canvas-container">
      @if (gameState() === 'ready') {
        <div class="overlay">
          <div class="raven-icon">üê¶‚Äç‚¨õ</div>
          <h2>Flappy Raven</h2>
          <p>Tap or press Space to fly!</p>
          <p class="hint">Avoid the pipes</p>
          <button class="nes-btn is-primary" type="button" (click)="startGame()">
            <app-pixel-icon name="play_arrow" />
            Start
          </button>
        </div>
      }

      @if (gameState() === 'lost') {
        <div class="overlay lose">
          <app-pixel-icon name="sentiment_very_dissatisfied" class="game-icon" />
          <h2>Game Over</h2>
          <p>Score: {{ score() }}</p>
          @if (score() === bestScore() && score() > 0) {
            <p class="new-record">New Best!</p>
          }
          <button class="nes-btn is-primary" type="button" (click)="onCanvasClick()">
            <app-pixel-icon name="replay" />
            Try Again
          </button>
        </div>
      }

      <canvas #gameCanvas (click)="onCanvasClick()"></canvas>
    </div>
  </div>
</div>
