<div [style.width.px]="width()" [style.height.px]="height()" #elementWithDrag appDraggable appResizable [minimalWidth]="600" [minimalHeight]="400" (windowResize)="onResize($event)" [appDraggableInitialPosition]="initialPosition()" class="float-window">

  <!-- Header acts as the drag handle -->
  <div class="drag-handle" [class.cursor-grab]="!isDragging" [class.cursor-grabbing]="isDragging" (mousedown)="isDragging = true" (mouseup)="isDragging = false">
    <h2>{{ title() }}</h2>
    <!-- Close button -->
    <button (click)="close()" class="drag-handle-close">
      &times;
    </button>
  </div>

  <!-- Window Content -->
  <div class="float-window-content roadmap-content">

    <!-- Header Stats -->
    <div class="nes-container with-title roadmap-header">
      <p class="title">Development Roadmap</p>
      <div class="roadmap-stats">
        <div class="stat-item">
          <span class="stat-value">{{ totalQuarters() }}</span>
          <span class="stat-label">Quarters</span>
        </div>
        <div class="stat-item">
          <span class="stat-value">{{ totalItems() }}</span>
          <span class="stat-label">Total Items</span>
        </div>
        <div class="stat-item">
          <span class="stat-value">{{ completedItems() }}</span>
          <span class="stat-label">Completed</span>
        </div>
      </div>
    </div>

    <!-- Quarters Timeline -->
    <div class="roadmap-timeline">
      @for (quarter of roadmapData(); track quarter.id) {
        <div class="quarter-item nes-container" [class.is-current]="quarter.isCurrent" [class.is-expanded]="quarterExpanded(quarter.id)">

          <!-- Quarter Header (clickable) -->
          <div class="quarter-header" (click)="toggleQuarter(quarter.id)">
            <div class="quarter-title-row">
              <h3 class="quarter-title">{{ quarter.quarter }}</h3>
              @if (quarter.isCurrent) {
                <span class="nes-badge is-warning">CURRENT</span>
              }
            </div>

            <!-- Progress Bar -->
            <div class="quarter-progress">
              <progress class="nes-progress is-primary"
                        [value]="getQuarterProgress(quarter)"
                        max="100"></progress>
              <span class="progress-text">
                {{ getQuarterProgress(quarter) }}% Complete
                ({{ getCompletedCount(quarter) }}/{{ getTotalCount(quarter) }})
              </span>
            </div>

            <span class="quarter-arrow">
              {{ quarterExpanded(quarter.id) ? '▼' : '▶' }}
            </span>
          </div>

          <!-- Quarter Content (collapsible) -->
          <div class="quarter-content">
            @for (section of quarter.sections; track $index) {
              <div class="roadmap-section">
                @if (section.title) {
                  <div class="section-header">
                    <h4 class="section-title">
                      @if (section.badge === 'progress') {
                        <cvd-pixel-icon name="autorenew" size="sm"></cvd-pixel-icon>
                      } @else if (section.badge === 'success') {
                        <cvd-pixel-icon name="check" size="sm"></cvd-pixel-icon>
                      }
                      {{ section.title }} ({{ section.items.length }})
                    </h4>
                  </div>
                }

                <div class="items-list">
                  @for (item of section.items; track $index) {
                    <div class="roadmap-item">
                      <cvd-checkbox [(checked)]="item.completed" [disabled]="true" [label]="item.text"></cvd-checkbox>
                      <!-- <label class="nes-checkbox">
                        <input type="checkbox" [checked]="item.completed" disabled />
                        <span></span>
                        <span class="item-text" [class.completed]="item.completed"> {{ item.text }} </span>
                      </label> -->
                    </div>
                  }
                </div>
              </div>
            }
          </div>
        </div>
      }
    </div>

  </div>
</div>
