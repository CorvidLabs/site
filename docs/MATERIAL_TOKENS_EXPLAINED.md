# Angular Material System Tokens Explained

## What Are Material System Tokens?

Material system tokens (like `--mat-sys-on-primary`, `--mat-sys-surface`, etc.) are CSS custom properties automatically generated by Angular Material's theming system. They follow the Material Design 3 (M3) color system.

## Where Are They Defined?

### Automatic Generation

When you use `@include mat.all-component-themes($your-theme)` in your theme file, Angular Material automatically generates dozens of CSS variables based on the palette you specify.

**Example from corvid-theme.scss:**
```scss
$corvid-theme: mat.define-theme((
  color: (
    theme-type: dark,
    primary: mat.$violet-palette,  // ← This palette defines the tokens
    tertiary: mat.$cyan-palette,
  ),
));

@mixin theme() {
  @include mat.all-component-themes($corvid-theme);  // ← Tokens generated here
  
  // Your custom variables
  --theme-primary-accent: #f9e9c8;
}
```

### Generated Tokens

The `mat.all-component-themes()` mixin generates tokens like:

**Surface Colors:**
- `--mat-sys-surface` - Main surface/background
- `--mat-sys-surface-dim` - Dimmed surface
- `--mat-sys-surface-bright` - Bright surface
- `--mat-sys-surface-container` - Container background
- `--mat-sys-surface-container-low` - Low emphasis container
- `--mat-sys-surface-container-high` - High emphasis container

**Primary Colors:**
- `--mat-sys-primary` - Primary brand color
- `--mat-sys-on-primary` - Text/icons on primary color
- `--mat-sys-primary-container` - Primary container background
- `--mat-sys-on-primary-container` - Text on primary container

**Secondary, Tertiary, Error:**
- `--mat-sys-secondary`, `--mat-sys-on-secondary`
- `--mat-sys-tertiary`, `--mat-sys-on-tertiary`
- `--mat-sys-error`, `--mat-sys-on-error`

**Text Colors:**
- `--mat-sys-on-surface` - Text on surface
- `--mat-sys-on-surface-variant` - Secondary text on surface
- `--mat-sys-on-background` - Text on background

**Outline/Border:**
- `--mat-sys-outline` - Default border color
- `--mat-sys-outline-variant` - Lighter border color

And many more...

## How Token Values Are Determined

The actual color values come from the Material palette you specify:

```scss
primary: mat.$violet-palette  // Uses violet palette's tonal values
```

Each Material palette (like `mat.$violet-palette`) is a map of tonal values from 0 (darkest) to 100 (lightest). Angular Material uses these to calculate the system tokens based on whether it's a light or dark theme.

### For Dark Themes:
- `--mat-sys-primary` might use tone 80 from the palette
- `--mat-sys-on-primary` might use tone 20 (dark, for contrast)
- `--mat-sys-surface` uses neutral tones

### For Light Themes:
- `--mat-sys-primary` might use tone 40
- `--mat-sys-on-primary` might use tone 100 (white, for contrast)

## Why Use System Tokens vs. Custom Variables?

### Material System Tokens (`--mat-sys-*`)
✅ **Pros:**
- Automatic contrast handling
- Works with all Material components
- Follows Material Design guidelines
- Handles light/dark mode automatically

❌ **Cons:**
- Limited to Material's color calculations
- Can't fully customize without creating custom palettes
- May not match your exact brand colors

### Custom Theme Variables (`--theme-*`)
✅ **Pros:**
- Full control over exact colors
- Can match brand guidelines precisely
- Easy to understand and modify

❌ **Cons:**
- Manual contrast management required
- Only affects your custom styles, not Material components
- Need to ensure accessibility

## Best Practice: Use Both

Combine Material tokens for components with custom variables for brand-specific styling:

```scss
@mixin theme() {
  @include mat.all-component-themes($my-theme);  // Material tokens
  
  // Custom variables for your components
  --theme-primary-bg: #11111b;
  --theme-primary-accent: #f9e9c8;
}
```

In your styles:
```scss
.my-component {
  // Use custom variable for background
  background-color: var(--theme-primary-bg, var(--mat-sys-surface));
  
  // Use Material token for text (ensures proper contrast)
  color: var(--mat-sys-on-surface);
}

.active-button {
  background-color: var(--theme-primary-accent);
  // Use custom variable with good contrast, not Material token
  color: var(--theme-primary-bg);  // ✅ Good contrast
  // NOT: color: var(--mat-sys-on-primary);  // ❌ May not work with custom accent
}
```

## The Corvid Theme Issue

In the corvid theme:
- `--theme-primary-accent: #f9e9c8` (cream - very light)
- `--mat-sys-on-primary: ???` (generated from violet palette - designed for violet background)

When using Material's violet palette, `--mat-sys-on-primary` expects to sit on a violet background. When we override the background with cream (`--theme-primary-accent`), the contrast breaks.

**Solution:** Use custom variables that work together:
```scss
&.active {
  background-color: var(--theme-primary-accent);  // Cream
  color: var(--theme-primary-bg);  // Dark - ensures contrast
}
```

## Inspecting Material Tokens

### In Browser DevTools:
1. Inspect an element
2. Look at "Computed" styles
3. Scroll down to see all `--mat-sys-*` variables

### In Your Theme SCSS:
```scss
@debug mat.$violet-palette;  // See palette structure
```

## Custom Palettes and Tokens

To fully control Material tokens, you'd need to create a complete M3 palette with all sub-palettes (primary, secondary, neutral, neutral-variant, error). See `/docs/CUSTOM_COLOR_PALETTES.md` for details.

For most use cases, mixing Material palettes with custom CSS variables (as we do) is simpler and more maintainable.

## Summary

| Token Type | Where Defined | When to Use |
|------------|---------------|-------------|
| `--mat-sys-*` | Auto-generated by Material | Material components, automatic contrast |
| `--theme-*` | Your theme SCSS | Custom components, brand colors |

**Key Takeaway:** Material tokens are great for Material components, but when you override with custom colors, use custom variables for related properties (like text color) to ensure proper contrast.

## See Also

- [Material Design 3 Tokens](https://m3.material.io/foundations/design-tokens/overview)
- [Angular Material Theming](https://material.angular.dev/guide/theming)
- `/docs/CUSTOM_COLOR_PALETTES.md` - Creating custom palettes
- `/docs/THEMING.md` - General theming guide
